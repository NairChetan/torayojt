<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Search Page</title>
    <link rel="stylesheet" th:href="@{/css/noticeSearch.css}" href="../../static/css/noticeSearch.css">
    <!-- jQuery and jQuery UI -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/i18n/jquery-ui-i18n.min.js"></script>

    <script>
        $(function() {
              // Custom Japanese localization for jQuery UI DatePicker
        $.datepicker.regional['ja'] = {
            closeText: '閉じる',           // Close button text
            prevText: '前',               // Previous month button text
            nextText: '次',               // Next month button text
            currentText: '今日',           // Today button text
            monthNames: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],  // Months in Japanese
            monthNamesShort: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],  // Short months
            dayNames: ['日曜日', '月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日'],  // Full day names in Japanese
            dayNamesShort: ['日', '月', '火', '水', '木', '金', '土'],                   // Short day names (Sun to Sat)
            dayNamesMin: ['日', '月', '火', '水', '木', '金', '土'],                    // Minimal day names (appears on the calendar)
            weekHeader: '週',                        // Week header
            dateFormat: 'yyyymmdd',                  // Date format for selected value (YYYY/MM/DD)
            firstDay: 0,                             // Set Sunday as the first day of the week
            isRTL: false,
            showMonthAfterYear: true,                // Show month after year in the header
            yearSuffix: '年'                         // Year suffix
        };

        // Apply the Japanese localization
        $.datepicker.setDefaults($.datepicker.regional['ja']);

        // Initialize DatePicker with the merged settings
        $("#beginYmd, #endYmd").datepicker({
            dateFormat: 'yymmdd', // Format displayed when a date is selected (YYYY/MM/DD)
            changeYear: true,
            changeMonth: true,
             showButtonPanel: true,
            beforeShowDay: function (date) {
                var day = date.getDay();
                // Highlight Sundays
                if (day === 0) {
                    return [true, "sunday-highlight"];
                // Highlight Saturdays
                } else if (day === 6) {
                    return [true, "saturday-highlight"];
                }
                // Regular days
                return [true, ""];
            }
        });

            // Handle collapse/expand functionality
            $(".search-close").on("click", function(e) {
                e.preventDefault();
                var $contentRows = $(".search-criteria tr:not(:first-child):not(:last-child)");

                if ($contentRows.is(":visible")) {
                    $contentRows.hide();
                    $(this).text("Search Criteria Open");
                } else {
                    $contentRows.show();
                    $(this).text("Search Criteria Close");
                }
            });

            // AJAX search
            $(".search-btn").on("click", function(e) {
                e.preventDefault();

                // Gather form data
                var formData = {
                    beginYmd: $("#beginYmd").val(),
                    endYmd: $("#endYmd").val(),
                    title: $("#title").val(),
                    text: $("#text").val(),
                    importantFlg: $("#importantFlg").is(":checked") ? 'Y' : null // Set to null if unchecked
                };

                // Perform AJAX request
                $.ajax({
                    url: "/list",
                    type: "GET",
                    data: formData,
                    success: function(response) {
                        // Clear the current table body
                        $(".results-table tbody").empty();

                        // Check if there are results
                        if (response.length > 0) {
                            // Show the table (including headers)
                            $(".results-table").show();
                            $.each(response, function(index, baseInfo) {
                                var row = `<tr>
                                    <td>${baseInfo.beginYmd} ~ ${baseInfo.endYmd}</td>
                                    <td>every</td>
                                    <td><a href="/noticeDetail/${baseInfo.seqInfo}">${baseInfo.title}</a></td>
                                    <td>${new Date(baseInfo.updTimestamp).toLocaleString()}</td>
                                </tr>`;
                                $(".results-table tbody").append(row);
                            });
                            $(".results-info").html(response.length + " hit 1~" + response.length + " display").show();
                        } else {
                            $(".results-info").html("No results found").show();
                        }
                    },
                    error: function() {
                        $(".results-info").html("An error occurred while fetching data").show();
                    }
                });
            });
        });
    </script>
</head>
<body>
<div th:replace="~{fragments/Navbar :: Navbar}"></div>
<div class="breadcrumb-container">
    <div class="breadcrumb">
        <span><a href="/toppage" style="text-decoration:none">TOP</a></span>
        <span class="separator">&gt;</span>
        <span>Admin Menu</span>
        <span class="separator">&gt;</span>
        <span>Notice List</span>
    </div>
    <div class="page-number">S15</div>
</div>
<form id="searchForm">
    <table class="search-criteria">
        <tr>
            <td colspan="3" class="header">Search Criteria</td>
            <td colspan="1" class="header">
                <a href="#" class="search-close">Search Criteria Close</a>
            </td>
        </tr>
        <tr class="content-row">
            <td class="label">Display period</td>
            <td>
                <input type="text" id="beginYmd" name="beginYmd" placeholder="YYYYMMDD"/>
                ~
                <input type="text" id="endYmd" name="endYmd" placeholder="YYYYMMDD"/>
            </td>
            <td class="label">Severity</td>
            <td>
                <input type="checkbox" id="importantFlg" name="importantFlg" VALUE="Y"/>
                <label for="importantFlg">Show only important</label>
            </td>
        </tr>
        <tr class="content-row">
            <td class="label">Subject of publication</td>
            <td colspan="3">
                <select name="subject">
                    <option value="every">every</option>
                </select>
            </td>
        </tr>
        <tr class="content-row1">
            <td class="label">Title</td>
            <td>
                <input type="text" id="title" name="title"/>
            </td>
            <td class="label">Text</td>
            <td>
                <input type="text" id="text" name="text"/>
            </td>
        </tr>
        <tr>
            <td colspan="4" class="button-row">
                <button type="button" class="new-btn" onclick="window.location.href='/register'">New</button>
                <button type="submit" class="search-btn">Search</button>
            </td>
        </tr>
    </table>
</form>

<!-- Only display table if there are results -->
<div class="results-info" style="display:none;"></div>

<table class="results-table" style="display:none;">
    <thead>
    <tr>
        <th>Display period</th>
        <th>Subject of publication</th>
        <th>Title</th>
        <th>Update</th>
    </tr>
    </thead>
    <tbody>
    <!-- Table rows will be inserted here by JavaScript -->
    </tbody>

</table>
</body>
</html>
