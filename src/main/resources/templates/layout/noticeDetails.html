<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Notice Detail</title>
    <link rel="stylesheet" th:href="@{/css/noticeDetails.css}" href="../../static/css/noticeDetails.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // On document ready, or when you want to trigger fetching of roles
            var seqInfo = [[${notice.seqInfo}]];  // Get seqInfo from Thymeleaf

            // Ajax call to fetch roles based on seqInfo
            $.ajax({
                url: 'roles/' + seqInfo,
                method: 'GET',
                success: function(roles) {
                    // Assuming `roles` is a list of role strings
                    var checkboxList = $('.checkbox-list');
                    checkboxList.empty();  // Clear any existing roles

                    roles.forEach(function(role) {
                        var checkboxItem = `
                            <div class="checkbox-item">
<!--                                <input type="checkbox" value="${role}" id="role-${role}">-->
                                <label for="role-${role}">[${role}]</label>
                            </div>
                        `;
                        checkboxList.append(checkboxItem);
                    });
                },
                error: function() {
                    console.error('Failed to fetch roles.');
                }
            });

          $(document).ready(function() {
    $('.fix-btn').click(function() {
        var seqInfo = [[${notice.seqInfo}]]; // Get the seqInfo from Thymeleaf
        window.location.href = '/noticeUpdate/' + seqInfo;  // Redirect to the update page with seqInfo
    });
});

        $(document).ready(function() {
    $('.delete-btn').click(function() {
        var seqInfo = [[${notice.seqInfo}]]; // Get seq_info from the button's data attribute

        if (confirm('Are you sure you want to delete this record?')) {
            $.ajax({
                url: '/' + seqInfo, // API endpoint
                method: 'DELETE',
                success: function() {
                    alert('Record deleted successfully.');
                    // Optionally, remove the row from the table or reload the page
                    // $(this).closest('tr').remove(); // Remove the row from the table
                    location.reload(); // Reload the page (you can also use a more sophisticated approach)
                },
                error: function() {
                    alert('Failed to delete record. Please try again.');
                }
            });
        }
    });
    });
    });
    </script>


</head>
<body>
<div th:replace="~{fragments/Navbar :: Navbar}"></div>

<div class="breadcrumb-container">
    <div class="breadcrumb">
        <span><a href="/toppage">TOP</a></span>
        <span class="separator">&gt;</span>
        <span>Admin Menu</span>
        <span class="separator">&gt;</span>
        <span><a href="/search">Notice List</a></span>
        <span class="separator">&gt;</span>
        <span>Notice Detail</span>
    </div>
    <div class="page-number">S16</div>
</div>

<div class="header-buttons">
    <div class="button-group">
        <a href="/search" class="back-link">Back</a>
        <button class="fix-btn">fix</button>
        <button class="delete-btn">delete</button>
    </div>
</div>

<!-- Dynamic Section 1: Display Condition -->
<div class="section">
    <h2>Display Condition</h2>
    <table class="condition-table">
        <tr>
            <td class="label">Display Period</td>
            <td th:text="${#dates.format(notice.beginYmd, 'yyyy/MM/dd')} + ' ~ ' + ${#dates.format(notice.endYmd, 'yyyy/MM/dd')}"></td>
            <td class="label">Importance</td>
            <td th:text="${notice.importantFlg == 'Y' ? 'Important' : 'Normal'}"></td>
        </tr>
        <tr>
            <td class="label">Open List</td>
            <td colspan="3">
                <div class="checkbox-list">
                    <div class="checkbox-item">

                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <td class="label">Create</td>
            <td th:text="${#dates.format(notice.crtTimestamp, 'yyyy/MM/dd HH:mm:ss')} + ' ' + ${notice.crtUserId}"></td>
            <td class="label">Update</td>
            <td th:text="${#dates.format(notice.updTimestamp, 'yyyy/MM/dd HH:mm:ss')} + ' ' + ${notice.updUserId}"></td>
        </tr>
    </table>
</div>

<!-- Dynamic Section 2: Display Content -->
<div class="section">
    <h2>Display Content</h2>
    <table class="content-table">
        <tr>
            <td class="label">Title</td>
            <td th:text="${notice.title}"></td>
        </tr>
        <tr>
            <td class="label">Content</td>
            <td th:text="${notice.text}"></td>
        </tr>
        <tr>
            <td class="label">Attachment File</td>
            <td>
                <a th:href="@{'/download/' + ${notice.attachClassNo}}" th:text="${notice.attachClassNo != null ? 'attachment.pdf' : 'No attachment'}"></a>
            </td>
        </tr>
    </table>
</div>

<!-- Footer with Back, Fix and Delete buttons -->
<div class="header-buttons">

    <div class="button-group">
        <a href="/search" class="back-link">Back</a>
        <button class="fix-btn">fix</button>
        <button class="delete-btn">delete</button>
    </div>
</div>
</body>
</html>
